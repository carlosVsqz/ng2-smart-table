import { Row } from './row';
import { Column } from './column';
export class DataSet {
    constructor(data = [], columnSettings) {
        this.columnSettings = columnSettings;
        this.data = [];
        this.columns = [];
        this.rows = [];
        this.createColumns(columnSettings);
        this.setData(data);
        this.createNewRow();
    }
    setData(data) {
        this.data = data;
        this.createRows();
    }
    getColumns() {
        return this.columns;
    }
    getRows() {
        return this.rows;
    }
    getFirstRow() {
        return this.rows[0];
    }
    getLastRow() {
        return this.rows[this.rows.length - 1];
    }
    findRowByData(data) {
        return this.rows.find((row) => row.getData() === data);
    }
    deselectAll() {
        this.rows.forEach((row) => {
            row.isSelected = false;
        });
        // we need to clear selectedRow field because no one row selected
        this.selectedRow = undefined;
    }
    selectRow(row) {
        const previousIsSelected = row.isSelected;
        this.deselectAll();
        row.isSelected = !previousIsSelected;
        this.selectedRow = row;
        return this.selectedRow;
    }
    multipleSelectRow(row) {
        row.isSelected = !row.isSelected;
        this.selectedRow = row;
        return this.selectedRow;
    }
    selectPreviousRow() {
        if (this.rows.length > 0) {
            let index = this.selectedRow ? this.selectedRow.index : 0;
            if (index > this.rows.length - 1) {
                index = this.rows.length - 1;
            }
            this.selectRow(this.rows[index]);
            return this.selectedRow;
        }
    }
    selectFirstRow() {
        if (this.rows.length > 0) {
            this.selectRow(this.rows[0]);
            return this.selectedRow;
        }
    }
    selectLastRow() {
        if (this.rows.length > 0) {
            this.selectRow(this.rows[this.rows.length - 1]);
            return this.selectedRow;
        }
    }
    selectRowByIndex(index) {
        const rowsLength = this.rows.length;
        if (rowsLength === 0) {
            return;
        }
        if (!index) {
            this.selectFirstRow();
            return this.selectedRow;
        }
        if (index > 0 && index < rowsLength) {
            this.selectRow(this.rows[index]);
            return this.selectedRow;
        }
        // we need to deselect all rows if we got an incorrect index
        this.deselectAll();
    }
    willSelectFirstRow() {
        this.willSelect = 'first';
    }
    willSelectLastRow() {
        this.willSelect = 'last';
    }
    select(selectedRowIndex) {
        if (this.getRows().length === 0) {
            return;
        }
        if (this.willSelect) {
            if (this.willSelect === 'first') {
                this.selectFirstRow();
            }
            if (this.willSelect === 'last') {
                this.selectLastRow();
            }
            this.willSelect = '';
        }
        else {
            this.selectRowByIndex(selectedRowIndex);
        }
        return this.selectedRow;
    }
    createNewRow() {
        this.newRow = new Row(-1, {}, this);
        this.newRow.isInEditing = true;
    }
    /**
     * Create columns by mapping from the settings
     * @param settings
     * @private
     */
    createColumns(settings) {
        for (const id in settings) {
            if (settings.hasOwnProperty(id)) {
                this.columns.push(new Column(id, settings[id], this));
            }
        }
    }
    /**
     * Create rows based on current data prepared in data source
     * @private
     */
    createRows() {
        this.rows = [];
        this.data.forEach((el, index) => {
            this.rows.push(new Row(index, el, this));
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1zZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZzItc21hcnQtdGFibGUvc3JjL2xpYi9saWIvZGF0YS1zZXQvZGF0YS1zZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUM1QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWxDLE1BQU0sT0FBTyxPQUFPO0lBVWxCLFlBQVksT0FBbUIsRUFBRSxFQUFZLGNBQXNCO1FBQXRCLG1CQUFjLEdBQWQsY0FBYyxDQUFRO1FBTnpELFNBQUksR0FBZSxFQUFFLENBQUM7UUFDdEIsWUFBTyxHQUFrQixFQUFFLENBQUM7UUFDNUIsU0FBSSxHQUFlLEVBQUUsQ0FBQztRQUs5QixJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFRCxPQUFPLENBQUMsSUFBZ0I7UUFDdEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxVQUFVO1FBQ1IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxPQUFPO1FBQ0wsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ25CLENBQUM7SUFFRCxXQUFXO1FBQ1QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxVQUFVO1FBQ1IsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxhQUFh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QUMsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO2FBQ3ZEO1NBQ0Y7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsVUFBVTtRQUNSLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDOUIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm93IH0gZnJvbSAnLi9yb3cnO1xyXG5pbXBvcnQgeyBDb2x1bW4gfSBmcm9tICcuL2NvbHVtbic7XHJcblxyXG5leHBvcnQgY2xhc3MgRGF0YVNldCB7XHJcblxyXG4gIG5ld1JvdzogUm93O1xyXG5cclxuICBwcm90ZWN0ZWQgZGF0YTogQXJyYXk8YW55PiA9IFtdO1xyXG4gIHByb3RlY3RlZCBjb2x1bW5zOiBBcnJheTxDb2x1bW4+ID0gW107XHJcbiAgcHJvdGVjdGVkIHJvd3M6IEFycmF5PFJvdz4gPSBbXTtcclxuICBwcm90ZWN0ZWQgc2VsZWN0ZWRSb3c6IFJvdztcclxuICBwcm90ZWN0ZWQgd2lsbFNlbGVjdDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihkYXRhOiBBcnJheTxhbnk+ID0gW10sIHByb3RlY3RlZCBjb2x1bW5TZXR0aW5nczogT2JqZWN0KSB7XHJcbiAgICB0aGlzLmNyZWF0ZUNvbHVtbnMoY29sdW1uU2V0dGluZ3MpO1xyXG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG5cclxuICAgIHRoaXMuY3JlYXRlTmV3Um93KCk7XHJcbiAgfVxyXG5cclxuICBzZXREYXRhKGRhdGE6IEFycmF5PGFueT4pIHtcclxuICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICB0aGlzLmNyZWF0ZVJvd3MoKTtcclxuICB9XHJcblxyXG4gIGdldENvbHVtbnMoKTogQXJyYXk8Q29sdW1uPiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb2x1bW5zO1xyXG4gIH1cclxuXHJcbiAgZ2V0Um93cygpOiBBcnJheTxSb3c+IHtcclxuICAgIHJldHVybiB0aGlzLnJvd3M7XHJcbiAgfVxyXG5cclxuICBnZXRGaXJzdFJvdygpOiBSb3cge1xyXG4gICAgcmV0dXJuIHRoaXMucm93c1swXTtcclxuICB9XHJcblxyXG4gIGdldExhc3RSb3coKTogUm93IHtcclxuICAgIHJldHVybiB0aGlzLnJvd3NbdGhpcy5yb3dzLmxlbmd0aCAtIDFdO1xyXG4gIH1cclxuXHJcbiAgZmluZFJvd0J5RGF0YShkYXRhOiBhbnkpOiBSb3cge1xyXG4gICAgcmV0dXJuIHRoaXMucm93cy5maW5kKChyb3c6IFJvdykgPT4gcm93LmdldERhdGEoKSA9PT0gZGF0YSk7XHJcbiAgfVxyXG5cclxuICBkZXNlbGVjdEFsbCgpIHtcclxuICAgIHRoaXMucm93cy5mb3JFYWNoKChyb3cpID0+IHtcclxuICAgICAgcm93LmlzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgIH0pO1xyXG4gICAgLy8gd2UgbmVlZCB0byBjbGVhciBzZWxlY3RlZFJvdyBmaWVsZCBiZWNhdXNlIG5vIG9uZSByb3cgc2VsZWN0ZWRcclxuICAgIHRoaXMuc2VsZWN0ZWRSb3cgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RSb3cocm93OiBSb3cpOiBSb3cgfCB1bmRlZmluZWQge1xyXG4gICAgY29uc3QgcHJldmlvdXNJc1NlbGVjdGVkID0gcm93LmlzU2VsZWN0ZWQ7XHJcbiAgICB0aGlzLmRlc2VsZWN0QWxsKCk7XHJcblxyXG4gICAgcm93LmlzU2VsZWN0ZWQgPSAhcHJldmlvdXNJc1NlbGVjdGVkO1xyXG4gICAgdGhpcy5zZWxlY3RlZFJvdyA9IHJvdztcclxuXHJcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFJvdztcclxuICB9XHJcblxyXG4gIG11bHRpcGxlU2VsZWN0Um93KHJvdzogUm93KTogUm93IHtcclxuICAgIHJvdy5pc1NlbGVjdGVkID0gIXJvdy5pc1NlbGVjdGVkO1xyXG4gICAgdGhpcy5zZWxlY3RlZFJvdyA9IHJvdztcclxuXHJcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFJvdztcclxuICB9XHJcblxyXG4gIHNlbGVjdFByZXZpb3VzUm93KCk6IFJvdyB7XHJcbiAgICBpZiAodGhpcy5yb3dzLmxlbmd0aCA+IDApIHtcclxuICAgICAgbGV0IGluZGV4ID0gdGhpcy5zZWxlY3RlZFJvdyA/IHRoaXMuc2VsZWN0ZWRSb3cuaW5kZXggOiAwO1xyXG4gICAgICBpZiAoaW5kZXggPiB0aGlzLnJvd3MubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgIGluZGV4ID0gdGhpcy5yb3dzLmxlbmd0aCAtIDE7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zZWxlY3RSb3codGhpcy5yb3dzW2luZGV4XSk7XHJcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkUm93O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VsZWN0Rmlyc3RSb3coKTogUm93IHwgdW5kZWZpbmVkIHtcclxuICAgIGlmICh0aGlzLnJvd3MubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLnNlbGVjdFJvdyh0aGlzLnJvd3NbMF0pO1xyXG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFJvdztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNlbGVjdExhc3RSb3coKTogUm93IHwgdW5kZWZpbmVkIHtcclxuICAgIGlmICh0aGlzLnJvd3MubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLnNlbGVjdFJvdyh0aGlzLnJvd3NbdGhpcy5yb3dzLmxlbmd0aCAtIDFdKTtcclxuICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRSb3c7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZWxlY3RSb3dCeUluZGV4KGluZGV4OiBudW1iZXIpOiBSb3cgfCB1bmRlZmluZWQge1xyXG4gICAgY29uc3Qgcm93c0xlbmd0aDogbnVtYmVyID0gdGhpcy5yb3dzLmxlbmd0aDtcclxuICAgIGlmIChyb3dzTGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghaW5kZXgpIHtcclxuICAgICAgdGhpcy5zZWxlY3RGaXJzdFJvdygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFJvdztcclxuICAgIH1cclxuICAgIGlmIChpbmRleCA+IDAgJiYgaW5kZXggPCByb3dzTGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0Um93KHRoaXMucm93c1tpbmRleF0pO1xyXG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFJvdztcclxuICAgIH1cclxuICAgIC8vIHdlIG5lZWQgdG8gZGVzZWxlY3QgYWxsIHJvd3MgaWYgd2UgZ290IGFuIGluY29ycmVjdCBpbmRleFxyXG4gICAgdGhpcy5kZXNlbGVjdEFsbCgpO1xyXG4gIH1cclxuXHJcbiAgd2lsbFNlbGVjdEZpcnN0Um93KCkge1xyXG4gICAgdGhpcy53aWxsU2VsZWN0ID0gJ2ZpcnN0JztcclxuICB9XHJcblxyXG4gIHdpbGxTZWxlY3RMYXN0Um93KCkge1xyXG4gICAgdGhpcy53aWxsU2VsZWN0ID0gJ2xhc3QnO1xyXG4gIH1cclxuXHJcbiAgc2VsZWN0KHNlbGVjdGVkUm93SW5kZXg/OiBudW1iZXIpOiBSb3cgfCB1bmRlZmluZWQge1xyXG4gICAgaWYgKHRoaXMuZ2V0Um93cygpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy53aWxsU2VsZWN0KSB7XHJcbiAgICAgIGlmICh0aGlzLndpbGxTZWxlY3QgPT09ICdmaXJzdCcpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdEZpcnN0Um93KCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMud2lsbFNlbGVjdCA9PT0gJ2xhc3QnKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RMYXN0Um93KCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy53aWxsU2VsZWN0ID0gJyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNlbGVjdFJvd0J5SW5kZXgoc2VsZWN0ZWRSb3dJbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRSb3c7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVOZXdSb3coKSB7XHJcbiAgICB0aGlzLm5ld1JvdyA9IG5ldyBSb3coLTEsIHt9LCB0aGlzKTtcclxuICAgIHRoaXMubmV3Um93LmlzSW5FZGl0aW5nID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBjb2x1bW5zIGJ5IG1hcHBpbmcgZnJvbSB0aGUgc2V0dGluZ3NcclxuICAgKiBAcGFyYW0gc2V0dGluZ3NcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGNyZWF0ZUNvbHVtbnMoc2V0dGluZ3M6IGFueSkge1xyXG4gICAgZm9yIChjb25zdCBpZCBpbiBzZXR0aW5ncykge1xyXG4gICAgICBpZiAoc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoaWQpKSB7XHJcbiAgICAgICAgdGhpcy5jb2x1bW5zLnB1c2gobmV3IENvbHVtbihpZCwgc2V0dGluZ3NbaWRdLCB0aGlzKSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSByb3dzIGJhc2VkIG9uIGN1cnJlbnQgZGF0YSBwcmVwYXJlZCBpbiBkYXRhIHNvdXJjZVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgY3JlYXRlUm93cygpIHtcclxuICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgdGhpcy5kYXRhLmZvckVhY2goKGVsLCBpbmRleCkgPT4ge1xyXG4gICAgICB0aGlzLnJvd3MucHVzaChuZXcgUm93KGluZGV4LCBlbCwgdGhpcykpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==